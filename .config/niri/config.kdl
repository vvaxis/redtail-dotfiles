// ============================================================================
// NIRI CONFIGURATION — redtail
// Alinhado com o setup Hyprland do swordfish
// Ref: https://yalter.github.io/niri/Configuration:-Introduction
// ============================================================================


// ─── INPUT ──────────────────────────────────────────────────────────────────
// Teclado, touchpad e comportamento do mouse

input {
    keyboard {
        xkb {
            // Layout brasileiro (br), igual ao Hyprland
            layout "br"
        }
        // Key repeat: mesmos valores do Hyprland (rate 40, delay 200)
        repeat-delay 200
        repeat-rate 40
        numlock
    }

    touchpad {
        tap
        dwt
        dwtp
        drag false
        drag-lock
        // natural-scroll desligado, igual ao Hyprland
        // (remova a linha abaixo se quiser scroll invertido)
        natural-scroll
        accel-speed 0.2
        accel-profile "flat"
        scroll-method "two-finger"
    }

    mouse {
        // Sem customização por enquanto — ajuste se precisar
    }

    // Foco segue o mouse, como follow_mouse=1 no Hyprland
    focus-follows-mouse max-scroll-amount="0%"
}


// ─── LAYOUT ─────────────────────────────────────────────────────────────────
// Gaps, bordas, sombras e posicionamento de janelas

layout {
    // Gaps equivalentes ao Hyprland (gaps_in=5, gaps_out=14)
    // Niri usa um valor único; 14 fica próximo do gaps_out
    gaps 15

    center-focused-column "on-overflow"
	always-center-single-column
	
    // Larguras pré-definidas ao alternar com Mod+R
    preset-column-widths {
        proportion 0.33333
        proportion 0.5
        proportion 0.66667
    }

    // Janelas novas abrem em 70% da tela
    default-column-width { proportion 0.7; }

    // Focus ring — equivale ao border ativo do Hyprland
    // width=2 alinhado com border_size=2
    focus-ring {
        width 2
        active-color "#7fc8ff"
        inactive-color "#505050"
    }

    // Borda adicional desativada (focus-ring já cumpre o papel)
    border {
        off
    }

    // Sombra habilitada, equivalente ao shadow do Hyprland
    shadow {
        on
        draw-behind-window false
        softness 30
        spread 5
        offset x=0 y=5
        color "#0007"
    }

    tab-indicator {
        hide-when-single-tab
        gap 4
        width 4
        length total-proportion=0.3
        position "top"
        place-within-column
        active-color "#7fc8ff"
        inactive-color "#505050"
    }

    struts {
        left 15;
        right 15;
    }

}

window-rule {
    match app-id="^kitty$"
    default-column-display "tabbed"
}

// ─── GESTURES ───
gestures {
    hot-corners {
        top-left
    }
}

overview {
    zoom 0.5
    workspace-shadow {
        softness 20
        spread 10
        offset x=0 y=5
        color "#00000050"
    }
}


// ─── VISUAL ─────────────────────────────────────────────────────────────────
// Aparência global, CSD e screenshots

// Remove decorações client-side (bordas e rounded corners do app)
// Equivalente ao comportamento limpo do Hyprland com rounding=2
prefer-no-csd

// Cantos arredondados globais (rounding=2 no Hyprland)
window-rule {
    geometry-corner-radius 8
    clip-to-geometry true
}

// Screenshots vão para ~/Pictures/Screenshots (mesmo padrão do Hyprland)
screenshot-path "~/Pictures/Screenshots/Screenshot from %Y-%m-%d %H-%M-%S.png"

// Animações ativas (ajuste slowdown se quiser mais lento/rápido)
animations {
    // slowdown 1.0
}

// Hotkey overlay desativado no startup (menos poluição visual)
hotkey-overlay {
    skip-at-startup
}

//tema dark
spawn-at-startup "gsettings" "set" "org.gnome.desktop.interface" "color-scheme" "prefer-dark"


// ─── AUTOSTART ──────────────────────────────────────────────────────────────
// Programas iniciados junto com a sessão (espelho do Hyprland exec-once)

spawn-at-startup "waybar"
spawn-at-startup "swaync"
spawn-at-startup "nm-applet"
// spawn-at-startup "blueberry-tray"
// spawn-at-startup "swayidle"  // Adicione se configurar idle/lock


// ─── WINDOW RULES ───────────────────────────────────────────────────────────
// Regras específicas por aplicação

// WezTerm: fix de bug no tamanho inicial
window-rule {
    match app-id=r#"^org\.wezfurlong\.wezterm$"#
    default-column-width {}
}

// Firefox PiP como flutuante
window-rule {
    match app-id=r#"firefox$"# title="^Picture-in-Picture$"
    open-floating true
}

// LibreWolf PiP como flutuante
window-rule {
    match app-id=r#"librewolf$"# title="^Picture-in-Picture$"
    open-floating true
}

// Opacidade de janelas inativas (inactive_opacity=0.6 no Hyprland)
window-rule {
    match is-active=false
    opacity 0.6
}


// ─── KEYBINDINGS ────────────────────────────────────────────────────────────
// Alinhados com keybinds.conf do Hyprland (swordfish)
// Mod = Super (em TTY) ou Alt (em janela winit)

binds {
    // ── Programas ───────────────────────────────────────────────────────
    Mod+Z       { spawn "kitty"; }                        // Terminal
    Mod+TAB     { spawn "fuzzel"; }                       // App launcher (rofi no Hyprland)
    Mod+A       { spawn "librewolf"; }                    // Browser
    Mod+E       { spawn "thunar"; }                       // File manager
    Mod+G       { spawn "kitty" "-e" "btop"; }            // System monitor
    Mod+N       { spawn-sh "swaync-client -t"; }          // Painel de notificações
    Mod+Escape  { spawn "swaylock"; }                     // Lock screen
    Mod+B       { spawn "blueberry"; }                    // Bluetooth
    Mod+Shift+W { spawn-sh "pkill waybar; waybar &"; }    // Restart waybar

    // ── Controle de janelas ─────────────────────────────────────────────
    Mod+Q          { close-window; }                      // Fechar janela (killactive)
    Mod+V          { toggle-window-floating; }            // Toggle flutuante
    Mod+F          { maximize-column; }                   // Maximizar (≈ fullscreen)
    Mod+Shift+F    { fullscreen-window; }                 // Fullscreen real
    Mod+R          { switch-preset-column-width; }        // Ciclar larguras
    Mod+Shift+R    { switch-preset-window-height; }       // Ciclar alturas
    Mod+Ctrl+R     { reset-window-height; }               // Resetar altura
    Mod+C          { center-column; }                     // Centralizar coluna
    Mod+Ctrl+F     { expand-column-to-available-width; }  // Expandir ao espaço livre

    // ── Navegação entre janelas (arrows + vim keys) ─────────────────────
    Mod+Left   { focus-column-left; }
    Mod+Down   { focus-window-down; }
    Mod+Up     { focus-window-up; }
    Mod+Right  { focus-column-right; }
    Mod+H      { focus-column-left; }
    Mod+J      { focus-window-down; }
    Mod+K      { focus-window-up; }
    Mod+L      { focus-column-right; }

    // ── Mover janelas ───────────────────────────────────────────────────
    Mod+Ctrl+Left   { move-column-left; }
    Mod+Ctrl+Down   { move-window-down; }
    Mod+Ctrl+Up     { move-window-up; }
    Mod+Ctrl+Right  { move-column-right; }
    Mod+Ctrl+H      { move-column-left; }
    Mod+Ctrl+J      { move-window-down; }
    Mod+Ctrl+K      { move-window-up; }
    Mod+Ctrl+L      { move-column-right; }

    // ── Workspaces (foco) ───────────────────────────────────────────────
    Mod+1 { focus-workspace 1; }
    Mod+2 { focus-workspace 2; }
    Mod+3 { focus-workspace 3; }
    Mod+4 { focus-workspace 4; }
    Mod+5 { focus-workspace 5; }
    Mod+6 { focus-workspace 6; }
    Mod+7 { focus-workspace 7; }
    Mod+8 { focus-workspace 8; }
    Mod+9 { focus-workspace 9; }    

    // ── Workspaces (mover janela) — Mod+Shift igual ao Hyprland ─────────
    Mod+Shift+1 { move-column-to-workspace 1; }
    Mod+Shift+2 { move-column-to-workspace 2; }
    Mod+Shift+3 { move-column-to-workspace 3; }
    Mod+Shift+4 { move-column-to-workspace 4; }
    Mod+Shift+5 { move-column-to-workspace 5; }
    Mod+Shift+6 { move-column-to-workspace 6; }
    Mod+Shift+7 { move-column-to-workspace 7; }
    Mod+Shift+8 { move-column-to-workspace 8; }
    Mod+Shift+9 { move-column-to-workspace 9; }

    // ── Workspace scroll (sequencial) ───────────────────────────────────
    Mod+Page_Down  { focus-workspace-down; }
    Mod+Page_Up    { focus-workspace-up; }
    Mod+U          { focus-workspace-down; }
    Mod+I          { focus-workspace-up; }

    // ── Monitores ───────────────────────────────────────────────────────
    Mod+Shift+Left   { focus-monitor-left; }
    Mod+Shift+Down   { focus-monitor-down; }
    Mod+Shift+Up     { focus-monitor-up; }
    Mod+Shift+Right  { focus-monitor-right; }
    Mod+Shift+H      { focus-monitor-left; }
    Mod+Shift+J      { focus-monitor-down; }
    Mod+Shift+K      { focus-monitor-up; }
    Mod+Shift+L      { focus-monitor-right; }

    Mod+Shift+Ctrl+Left   { move-column-to-monitor-left; }
    Mod+Shift+Ctrl+Down   { move-column-to-monitor-down; }
    Mod+Shift+Ctrl+Up     { move-column-to-monitor-up; }
    Mod+Shift+Ctrl+Right  { move-column-to-monitor-right; }
    Mod+Shift+Ctrl+H      { move-column-to-monitor-left; }
    Mod+Shift+Ctrl+J      { move-column-to-monitor-down; }
    Mod+Shift+Ctrl+K      { move-column-to-monitor-up; }
    Mod+Shift+Ctrl+L      { move-column-to-monitor-right; }

    // ── Colunas (merge/split) ───────────────────────────────────────────
    Mod+BracketLeft   { consume-or-expel-window-left; }
    Mod+BracketRight  { consume-or-expel-window-right; }
    Mod+Comma         { consume-window-into-column; }
    Mod+Period        { expel-window-from-column; }
    Mod+W             { toggle-column-tabbed-display; }

    // ── Redimensionar ───────────────────────────────────────────────────
    Mod+Minus  { set-column-width "-10%"; }
    Mod+Equal  { set-column-width "+10%"; }
    Mod+Shift+Minus { set-window-height "-10%"; }
    Mod+Shift+Equal { set-window-height "+10%"; }

    Mod+Home      { focus-column-first; }
    Mod+End       { focus-column-last; }
    Mod+Ctrl+Home { move-column-to-first; }
    Mod+Ctrl+End  { move-column-to-last; }

    // ── Floating/Tiling toggle ──────────────────────────────────────────
    Mod+Shift+V { switch-focus-between-floating-and-tiling; }

    // ── Scroll (mouse wheel) ────────────────────────────────────────────
    Mod+WheelScrollDown       cooldown-ms=150 { focus-workspace-down; }
    Mod+WheelScrollUp         cooldown-ms=150 { focus-workspace-up; }
    Mod+Ctrl+WheelScrollDown  cooldown-ms=150 { move-column-to-workspace-down; }
    Mod+Ctrl+WheelScrollUp    cooldown-ms=150 { move-column-to-workspace-up; }
    Mod+WheelScrollRight      { focus-column-right; }
    Mod+WheelScrollLeft       { focus-column-left; }

    // ── Volume e mídia (PipeWire/WirePlumber) ───────────────────────────
    XF86AudioRaiseVolume allow-when-locked=true { spawn-sh "wpctl set-volume @DEFAULT_AUDIO_SINK@ 0.1+ -l 1.0"; }
    XF86AudioLowerVolume allow-when-locked=true { spawn-sh "wpctl set-volume @DEFAULT_AUDIO_SINK@ 0.1-"; }
    XF86AudioMute        allow-when-locked=true { spawn-sh "wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle"; }
    XF86AudioMicMute     allow-when-locked=true { spawn-sh "wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle"; }

    // ── Controles de mídia (playerctl) ──────────────────────────────────
    XF86AudioPlay allow-when-locked=true { spawn-sh "playerctl play-pause"; }
    XF86AudioStop allow-when-locked=true { spawn-sh "playerctl stop"; }
    XF86AudioPrev allow-when-locked=true { spawn-sh "playerctl previous"; }
    XF86AudioNext allow-when-locked=true { spawn-sh "playerctl next"; }

    // ── Brilho ──────────────────────────────────────────────────────────
    XF86MonBrightnessUp   allow-when-locked=true { spawn "brightnessctl" "--class=backlight" "set" "+10%"; }
    XF86MonBrightnessDown allow-when-locked=true { spawn "brightnessctl" "--class=backlight" "set" "10%-"; }

    // ── Screenshots ─────────────────────────────────────────────────────
    Print       { screenshot; }
    Ctrl+Print  { screenshot-screen; }
    Alt+Print   { screenshot-window; }

    // ── Overview e sessão ───────────────────────────────────────────────
    Mod+O          { toggle-overview; }
    Mod+Shift+E    { quit; }
    Ctrl+Alt+Delete { quit; }
    Mod+Shift+P    { power-off-monitors; }

    // ── Hotkey overlay ──────────────────────────────────────────────────
    Mod+Shift+Slash { show-hotkey-overlay; }
}
